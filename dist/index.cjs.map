{"version":3,"file":"index.cjs","sources":["../src/index.ts"],"sourcesContent":["export class Channel<T = any> {\r\n    #items: Set<Array<PromiseWithResolvers<IteratorResult<T>>>> = new Set<Array<PromiseWithResolvers<IteratorResult<T>>>>();\r\n\r\n    constructor() { }\r\n\r\n    send(data: T) {\r\n        for (const items of this.#items) {\r\n            items.push(Channel.#withResolvers<T>());\r\n            items[items.length - 2].resolve({ done: false, value: data });\r\n        }\r\n    }\r\n\r\n    close() {\r\n        for (const items of this.#items) {\r\n            items[items.length - 1].resolve({ done: true, value: undefined });\r\n            this.#items.delete(items);\r\n        }\r\n    }\r\n\r\n    static #withResolvers<T>() {\r\n        let resolve, reject;\r\n        const promise = new Promise<IteratorResult<T>>((res, rej) => {\r\n            resolve = res;\r\n            reject = rej;\r\n        });\r\n        return { resolve, reject, promise }\r\n    }\r\n\r\n    [Symbol.asyncIterator]() {\r\n        let channel = this;\r\n        let items: Array<PromiseWithResolvers<any>> = new Array<PromiseWithResolvers<any>>(Channel.#withResolvers<T>());\r\n        channel.#items.add(items);\r\n\r\n        return {\r\n            async next(): Promise<IteratorYieldResult<T>> {\r\n                if (items.length > 1) items.shift();\r\n                return items[0].promise;\r\n            },\r\n            return(value?: any): Promise<IteratorReturnResult<T>> {\r\n                channel.#items.delete(items);\r\n                return Promise.resolve({ done: true, value: value });\r\n            }\r\n        };\r\n    }\r\n}"],"names":["_items","_classPrivateFieldLooseKey","_withResolvers","Channel","Object","defineProperty","writable","value","Set","_proto","prototype","send","data","_iterator","_step","_createForOfIteratorHelperLoose","_classPrivateFieldLooseBase","this","done","items","push","length","resolve","close","_step2","_iterator2","undefined","Symbol","asyncIterator","channel","Array","add","next","shift","Promise","promise","e","reject","res","rej"],"mappings":"s9BAAA,IAAAA,eAAAC,EAAA,SAAAC,eAAAD,EAAA,iBAAaE,eAAO,WAGhB,SAAAA,IAAAC,OAAAC,eAAAL,KAAAA,GAAAM,UAAA,EAAAC,MAF8D,IAAIC,KAElD,CAAC,IAAAC,EAAAN,EAAAO,UAwChBP,OAxCgBM,EAEjBE,KAAA,SAAKC,GACD,IAAAC,IAAwBC,EAAxBD,EAAAE,EAAAC,EAAoBC,KAAIjB,GAAAA,MAAAc,EAAAD,KAAAK,MAAS,CAAA,IAAtBC,EAAKL,EAAAP,MACZY,EAAMC,KAAIJ,EAACb,EAAOD,GAAAA,MAClBiB,EAAMA,EAAME,OAAS,GAAGC,QAAQ,CAAEJ,MAAM,EAAOX,MAAOK,GAC1D,CACJ,EAACH,EAEDc,MAAA,WACI,QAAwBC,EAAxBC,EAAAV,EAAAC,EAAoBC,KAAIjB,GAAAA,MAAAwB,EAAAC,KAAAP,MAAS,CAAtB,IAAAC,EAAKK,EAAAjB,MACZY,EAAMA,EAAME,OAAS,GAAGC,QAAQ,CAAEJ,MAAM,EAAMX,WAAOmB,IACrDV,EAAAC,KAAIjB,GAAAA,GAAc,OAACmB,EACvB,CACJ,EAACV,EAWAkB,OAAOC,eAAR,WACI,IAAIC,EAAUZ,KACVE,EAA0C,IAAIW,MAAKd,EAA4Bb,EAAOD,GAAAA,MAG1F,OAFAc,EAAAa,EAAO7B,GAAAA,GAAQ+B,IAAIZ,GAEZ,CACGa,KAAA,eAEF,OADIb,EAAME,OAAS,GAAGF,EAAMc,QAC5BC,QAAAZ,QAAOH,EAAM,GAAGgB,QACpB,CAAC,MAAAC,UAAAF,QAAAG,OAAAD,qBACM7B,GAEH,OADAS,EAAAa,EAAO7B,GAAAA,UAAemB,GACfe,QAAQZ,QAAQ,CAAEJ,MAAM,EAAMX,MAAOA,GAChD,EAER,EAACJ,CAAA,CA3Ce,GA0BfC,OAAAC,eA1BQF,EAAOD,EAAAK,CAAAA,MA4CnB,WAxBO,IAAIe,EAASe,EACPF,EAAU,IAAID,QAA2B,SAACI,EAAKC,GACjDjB,EAAUgB,EACVD,EAASE,CACb,GACA,MAAO,CAAEjB,QAAAA,EAASe,OAAAA,EAAQF,QAAAA,EAC9B"}