{"version":3,"file":"index.modern.js","sources":["../src/index.ts"],"sourcesContent":["export class Channel<T = any> {\r\n    #items: Set<Array<PromiseWithResolvers<IteratorResult<T>>>> = new Set<Array<PromiseWithResolvers<IteratorResult<T>>>>();\r\n\r\n    constructor() { }\r\n\r\n    send(data: T) {\r\n        for (const items of this.#items) {\r\n            items.push(Channel.#withResolvers<T>());\r\n            items[items.length - 2].resolve({ done: false, value: data });\r\n        }\r\n    }\r\n\r\n    close() {\r\n        for (const items of this.#items) {\r\n            items[items.length - 1].resolve({ done: true, value: undefined });\r\n            this.#items.delete(items);\r\n        }\r\n    }\r\n\r\n    static #withResolvers<T>() {\r\n        let resolve, reject;\r\n        const promise = new Promise<IteratorResult<T>>((res, rej) => {\r\n            resolve = res;\r\n            reject = rej;\r\n        });\r\n        return { resolve, reject, promise }\r\n    }\r\n\r\n    [Symbol.asyncIterator]() {\r\n        let channel = this;\r\n        let items: Array<PromiseWithResolvers<any>> = new Array<PromiseWithResolvers<any>>(Channel.#withResolvers<T>());\r\n        channel.#items.add(items);\r\n\r\n        return {\r\n            async next(): Promise<IteratorYieldResult<T>> {\r\n                if (items.length > 1) items.shift();\r\n                return items[0].promise;\r\n            },\r\n            return(value?: any): Promise<IteratorReturnResult<T>> {\r\n                channel.#items.delete(items);\r\n                return Promise.resolve({ done: true, value: value });\r\n            }\r\n        };\r\n    }\r\n}"],"names":["_items","_classPrivateFieldLooseKey","_withResolvers","Channel","constructor","Object","defineProperty","writable","value","Set","send","data","items","_classPrivateFieldLooseBase","this","push","length","resolve","done","close","undefined","delete","Symbol","asyncIterator","channel","Array","add","async","next","shift","promise","return","Promise","reject","res","rej"],"mappings":"kLAAA,IAAAA,eAAAC,EAAA,SAAAC,eAAAD,EAAA,iBAAa,MAAAE,EAGTC,WAAAA,GAAAC,OAAAC,eAAAN,KAAAA,GAAAO,UAAA,EAAAC,MAF8D,IAAIC,KAElD,CAEhBC,IAAAA,CAAKC,GACD,IAAK,MAAMC,KAAKC,EAAIC,KAAId,GAAAA,GACpBY,EAAMG,KAAIF,EAACV,EAAOD,GAAAA,MAClBU,EAAMA,EAAMI,OAAS,GAAGC,QAAQ,CAAEC,MAAM,EAAOV,MAAOG,GAE9D,CAEAQ,KAAAA,GACI,IAAK,MAAMP,KAAKC,EAAIC,KAAId,GAAAA,GACpBY,EAAMA,EAAMI,OAAS,GAAGC,QAAQ,CAAEC,MAAM,EAAMV,WAAOY,IACrDP,EAAAC,KAAId,GAAAA,GAAQqB,OAAOT,EAE3B,CAWA,CAACU,OAAOC,iBACJ,IAAIC,EAAUV,KACVF,EAA0C,IAAIa,MAAKZ,EAA4BV,EAAOD,GAAAA,MAG1F,OAFAW,EAAAW,EAAOxB,GAAAA,GAAQ0B,IAAId,GAEZ,CACHe,KAAUC,UACFhB,EAAMI,OAAS,GAAGJ,EAAMiB,QACrBjB,EAAM,GAAGkB,SAEpBC,OAAOvB,IACHK,EAAAW,EAAOxB,GAAAA,GAAQqB,OAAOT,GACfoB,QAAQf,QAAQ,CAAEC,MAAM,EAAMV,MAAOA,KAGxD,EAjBCH,OAAAC,eA1BQH,EAAOD,EAAAM,CAAAA,MA4CnB,WAxBO,IAAIS,EAASgB,EACb,MAAMH,EAAU,IAAIE,QAA2B,CAACE,EAAKC,KACjDlB,EAAUiB,EACVD,EAASE,CACb,GACA,MAAO,CAAElB,UAASgB,SAAQH,UAC9B"}